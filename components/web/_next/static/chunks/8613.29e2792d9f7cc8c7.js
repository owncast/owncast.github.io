(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8613],{38613:function(e,n,t){"use strict";t.r(n),t.d(n,{ChatModerationActionMenu:function(){return I}});var a=t(85893),o=t(77786),s=t(87508),r=t(70449),l=t(4116),c=t(67294),i=t(5152),d=t.n(i),u=t(4955),h=t(86560),m=t(10227),p=t(78021),x=t(56469),j=t(93879),y=t(91624),b=t(27043),f=t(12642),g=t(4511);class k{static async removeMessage(e,n){let t=new URL("/api/chat/messagevisibility",window.location.toString());t.searchParams.append("accessToken",n);let a=t.toString(),o={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idArray:[e]})};await fetch(a,o)}static async banUser(e,n){let t=new URL("/api/chat/users/setenabled",window.location.toString());t.searchParams.append("accessToken",n);let a=t.toString(),o={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e})};await fetch(a,o)}}var w=t(3568),C=t.n(w),M=t(74040),v=t(69583);let{Panel:_}=h.default,S=d()(()=>Promise.all([t.e(3247),t.e(1506)]).then(t.t.bind(t,81506,23)),{loadableGenerated:{webpack:()=>[81506]},ssr:!1}),P=async(e,n)=>{try{k.removeMessage(e,n)}catch(e){console.error(e)}},Z=e=>{let{label:n,value:t}=e;return(0,a.jsxs)(m.Z,{justify:"space-around",align:"middle",children:[(0,a.jsx)(p.Z,{span:12,children:n}),(0,a.jsx)(p.Z,{span:12,children:t})]})},A=e=>{let{client:n}=e,{messageCount:t,connectedAt:o,geo:s}=n,r=(0,f.WU)(new Date(o),"PP pp");return(0,a.jsxs)("div",{children:[(0,a.jsx)(Z,{label:"Messages Sent",value:t.toString()}),"N/A"!==s&&(0,a.jsx)(Z,{label:"Geo",value:s}),(0,a.jsx)(Z,{label:"Connected At",value:r})]})},N=e=>{let{color:n}=e,t="var(--theme-color-users-".concat(n,")");return(0,a.jsxs)("div",{className:C().colorBlock,style:{backgroundColor:t},children:["Color ",n]})},O=e=>{let{userId:n,accessToken:t}=e,[o,s]=(0,c.useState)(null),[r,l]=(0,c.useState)(!0),i=async()=>{try{let e=await (await fetch("/api/moderation/chat/user/".concat(n,"?accessToken=").concat(t))).json();s(e),l(!1)}catch(e){console.error(e)}};if((0,c.useEffect)(()=>{i()},[]),!o)return null;let{user:d,connectedClients:u,messages:m}=o,{displayColor:p,createdAt:k,previousNames:w,scopes:C,isBot:O,authenticated:D}=d,T=u.reduce((e,n)=>e+n.messageCount,0),U=(0,f.WU)(new Date(k),"PP pp"),B=[{title:"Message",dataIndex:"body",key:"body"},{title:"Sent At",dataIndex:"timestamp",key:"timestamp",render:e=>(0,f.WU)(new Date(e),"PP pp")},{title:"Delete",key:"delete",render:(e,n)=>(0,a.jsx)(x.Z,{type:"primary",ghost:!0,icon:(0,a.jsx)(S,{}),onClick:()=>P(n.id,t)})}];return(0,a.jsx)(g.SV,{fallbackRender:e=>{let{error:n,resetErrorBoundary:t}=e;return(0,a.jsx)(v.A,{componentName:"ChatModerationDetailsModal",message:n.message,retryFunction:t})},children:(0,a.jsxs)(j.Z,{spinning:r,children:[(0,a.jsx)(N,{color:p}),null==C?void 0:C.map(e=>(0,a.jsx)(y.Z,{children:e},e)),D&&(0,a.jsx)(y.Z,{children:"Authenticated"}),O&&(0,a.jsx)(y.Z,{children:"Bot"}),(0,a.jsx)(Z,{label:"Messages Sent Across Clients",value:T.toString()}),(0,a.jsx)(Z,{label:"User Created",value:U}),(0,a.jsx)(Z,{label:"Known As",value:w.join(",")}),(0,a.jsxs)(h.default,{accordion:!0,children:[(0,a.jsx)(_,{header:"Currently Connected Clients",children:(0,a.jsx)(h.default,{accordion:!0,children:u.map(e=>(0,a.jsx)(_,{header:(0,M.AB)(e.userAgent),children:(0,a.jsx)(A,{client:e})},e.id))})},"connected-clients"),(0,a.jsx)(h.default,{accordion:!0,children:(0,a.jsx)(_,{header:"Recent Chat Messages",children:(0,a.jsx)(b.Z,{size:"small",pagination:null,columns:B,dataSource:m,rowKey:"id"})},"chat-messages")})]})]})})},{confirm:D}=o.default,T=d()(()=>Promise.all([t.e(3247),t.e(8142)]).then(t.t.bind(t,18142,23)),{loadableGenerated:{webpack:()=>[18142]},ssr:!1}),U=d()(()=>Promise.all([t.e(3247),t.e(8527)]).then(t.t.bind(t,48527,23)),{loadableGenerated:{webpack:()=>[48527]},ssr:!1}),B=d()(()=>Promise.all([t.e(3247),t.e(112)]).then(t.t.bind(t,80112,23)),{loadableGenerated:{webpack:()=>[80112]},ssr:!1}),R=d()(()=>Promise.all([t.e(3247),t.e(3033)]).then(t.t.bind(t,33033,23)),{loadableGenerated:{webpack:()=>[33033]},ssr:!1}),I=e=>{let{messageID:n,userID:t,userDisplayName:o,accessToken:i}=e,[d,h]=(0,c.useState)(!1),m=async()=>{try{await k.banUser(t,i)}catch(e){console.error(e),s.ZP.error(e)}},p=async()=>{try{await k.removeMessage(n,i)}catch(e){console.error(e),s.ZP.error(e)}},x=async()=>{D({icon:(0,a.jsx)(U,{}),content:"Are you sure you want to remove this message from ".concat(o,"?"),onOk(){p()}})},j=async()=>{D({icon:(0,a.jsx)(U,{}),content:"Are you sure you want to ban ".concat(o," from chat?"),onOk(){m()}})},y=[{icon:(0,a.jsx)(B,{}),label:"Hide Message",key:"hide-message",onClick:x},{icon:(0,a.jsx)(T,{}),label:"Ban User",key:"ban-user",onClick:j},{label:"More Info...",key:"more-info",onClick:()=>h(!0)}];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.Z,{menu:{items:y},trigger:["click"],children:(0,a.jsx)("button",{type:"button","aria-label":"Chat moderation options",onClick:e=>e.preventDefault(),children:(0,a.jsx)(l.Z,{children:(0,a.jsx)(R,{})})})}),(0,a.jsx)(u.Modal,{title:o,open:d,handleCancel:()=>{h(!1)},children:(0,a.jsx)(O,{userId:t,accessToken:i})})]})}},4955:function(e,n,t){"use strict";t.r(n),t.d(n,{Modal:function(){return u}});var a=t(85893),o=t(77786),s=t(93879),r=t(67294),l=t(4511),c=t(69583),i=t(81820),d=t.n(i);let u=e=>{let{title:n,url:t,open:i,handleOk:u,handleCancel:h,afterClose:m,height:p,width:x,children:j}=e,[y,b]=(0,r.useState)(!!t),f="100%",g="520px";t&&(f="70vh",g="900px");let k={padding:"0px",minHeight:p,height:null!=p?p:f},w=t&&(0,a.jsx)("iframe",{title:n,src:t,width:"100%",height:"100%",sandbox:"allow-same-origin allow-scripts allow-popups allow-forms",frameBorder:"0",allowFullScreen:!0,style:{display:"block"},onLoad:()=>b(!1)}),C=y?"none":"inline";return(0,a.jsx)(o.default,{title:n,open:i,onOk:u,onCancel:h,afterClose:m,bodyStyle:k,width:null!=x?x:g,zIndex:999,footer:null,centered:!0,destroyOnClose:!0,className:d().modal,children:(0,a.jsx)(l.SV,{fallbackRender:e=>{let{error:n,resetErrorBoundary:t}=e;return(0,a.jsx)(c.A,{componentName:"Modal",message:n.message,retryFunction:t})},children:(0,a.jsxs)("div",{id:"modal-container",style:{height:"100%"},children:[w&&(0,a.jsx)("div",{style:{display:C},children:w}),j&&(0,a.jsx)("div",{className:d().content,children:j}),y&&(0,a.jsx)(s.Z,{className:d().spinner,spinning:y,size:"large",tip:n})]})})})}},74040:function(e,n,t){"use strict";t.d(n,{AB:function(){return i},Qr:function(){return r},t5:function(){return s},wS:function(){return c}});var a=t(42238),o=t.n(a);function s(e){let n=e.split(":");n[n.length-1]="";let t=n.join(":");return"[::1]"===(t=t.slice(0,t.length-1))||"127.0.0.1"===t?"Localhost":t}function r(e){return!e||0===Object.keys(e).length&&e.constructor===Object}function l(e,n,t){return String(n.repeat(t)+e).slice(-t)}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=Number.isFinite(+e)?Math.abs(e):0,t=Math.floor(n/86400),a=t>0?"".concat(t," day").concat(t>1?"s":""," "):"",o=Math.floor(n/3600%24);return a+(o||t?l("".concat(o,":"),"0",3):"")+l("".concat(Math.floor(n/60%60),":"),"0",3)+l("".concat(Math.floor(n%60)),"0",2)}function i(e){let{device:n,os:t,browser:a}=o()(e),{major:s,name:r}=a,{version:l,name:c}=t,{model:i,type:d}=n;return"libmpv"===e?"mpv media player":r&&s&&c?"".concat(r," ").concat(s," on ").concat(c," ").concat(l,"\n  ").concat(i||d?" (".concat(i||d,")"):""):e}},3568:function(e){e.exports={modalContainer:"ChatModerationDetailsModal_modalContainer__mtTcg",chatHistory:"ChatModerationDetailsModal_chatHistory__Iksxq",colorBlock:"ChatModerationDetailsModal_colorBlock__eRrFu",displayName:"ChatModerationDetailsModal_displayName__vcRZ5"}},81820:function(e){e.exports={spinner:"Modal_spinner__vORWo",content:"Modal_content__mZkaV",modal:"Modal_modal___vOcW"}}}]);