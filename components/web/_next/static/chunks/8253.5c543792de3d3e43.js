(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8253],{8253:function(e,t,o){"use strict";o.r(t),o.d(t,{BrowserNotifyModal:function(){return k}});var r=o(85893),n=o(23657),i=o(56469),s=o(93879),a=o(10227),l=o(1461),d=o(67294),c=o(61337),f=o(99677),u=o(4480),h=o(4511),p=o(37039),w=o(28049);async function y(e,t,o){console.log("saveNotificationRegistration");let r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({channel:e,destination:t})};await fetch("".concat("/api/notifications/register","?accessToken=").concat(o),r)}async function x(e){let t=await navigator.serviceWorker.ready,o=await t.pushManager.getSubscription();return o||(o=await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){let t="=".repeat((4-e.length%4)%4),o=(e+t).replace(/-/g,"+").replace(/_/g,"/"),r=window.atob(o),n=new Uint8Array(r.length);for(let e=0;e<r.length;++e)n[e]=r.charCodeAt(e);return n}(e)})),JSON.stringify(o)}var j=o(38355),v=o.n(j),m=o(69583),N=o(11660),b=o(53278),g=o(30651),M=o(65146);let{Title:W}=n.default,_=()=>(0,r.jsx)("div",{children:(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.unsupported,defaultText:"Browser notifications are not supported in your browser."})}),B=()=>(0,r.jsx)("div",{children:(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.unsupportedLocal,defaultText:"Browser notifications are not supported for local servers."})}),T=()=>(0,r.jsxs)("div",{children:[(0,r.jsx)(W,{level:3,children:(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.iosTitle,defaultText:"Get notified on iOS"})}),(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.iosDescription,defaultText:"It takes a couple extra steps to make sure you get notified when your favorite streams go live."}),(0,r.jsxs)("ol",{children:[(0,r.jsxs)("li",{children:["Tap the"," ",(0,r.jsx)("strong",{children:(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.iosShareButton,defaultText:"share"})})," ","button ",(0,r.jsx)(c.default,{})," in Safari."]}),(0,r.jsxs)("li",{children:["Scroll down and tap"," ",(0,r.jsxs)("strong",{children:["“",(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.iosAddToHomeScreen,defaultText:"Add to Home Screen"}),"”"]})," ",(0,r.jsx)(f.Z,{}),"."]}),(0,r.jsxs)("li",{children:["Tap"," ",(0,r.jsxs)("strong",{children:["“",(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.iosAddButton,defaultText:"Add"}),"”"]}),"."]}),(0,r.jsx)("li",{children:(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.iosNameAndTap,defaultText:"Give this link a name and tap the new icon on your home screen"})}),(0,r.jsx)("li",{children:(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.iosComeBack,defaultText:"Come back to this screen and enable notifications."})}),(0,r.jsxs)("li",{children:["Tap"," ",(0,r.jsxs)("strong",{children:["“",(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.iosAllowPrompt,defaultText:"Allow"}),"”"]})," ","when prompted."]})]})]}),O=e=>{let{start:t}=e;return(0,r.jsx)("div",{id:"browser-push-preview-box",className:v().pushPreview,children:(0,r.jsxs)("div",{className:v().inner,children:[(0,r.jsx)("div",{className:v().title,children:(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.permissionWantsTo,defaultText:"{{hostname}} wants to",vars:{hostname:window.location.hostname}})}),(0,r.jsxs)("div",{className:v().permissionLine,children:[(0,r.jsx)("svg",{className:v().bell,width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{d:"M14 12.3333V13H2V12.3333L3.33333 11V7C3.33333 4.93333 4.68667 3.11333 6.66667 2.52667C6.66667 2.46 6.66667 2.4 6.66667 2.33333C6.66667 1.97971 6.80714 1.64057 7.05719 1.39052C7.30724 1.14048 7.64638 1 8 1C8.35362 1 8.69276 1.14048 8.94281 1.39052C9.19286 1.64057 9.33333 1.97971 9.33333 2.33333C9.33333 2.4 9.33333 2.46 9.33333 2.52667C11.3133 3.11333 12.6667 4.93333 12.6667 7V11L14 12.3333ZM9.33333 13.6667C9.33333 14.0203 9.19286 14.3594 8.94281 14.6095C8.69276 14.8595 8.35362 15 8 15C7.64638 15 7.30724 14.8595 7.05719 14.6095C6.80714 14.3594 6.66667 14.0203 6.66667 13.6667",fill:"#676670"})}),(0,r.jsx)("span",{className:v().showNotificationsText,children:(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.showNotifications,defaultText:"Show notifications"})})]}),(0,r.jsxs)("div",{className:v().buttonRow,children:[(0,r.jsx)(i.Z,{type:"primary",onClick:()=>{t()},children:(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.allowButton,defaultText:"Allow"})}),(0,r.jsx)("button",{type:"button",className:v().disabled,children:(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.blockButton,defaultText:"Block"})})]})]})})},F=()=>(0,r.jsxs)("div",{children:[(0,r.jsx)(W,{level:2,children:(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.enabledTitle,defaultText:"Notifications are enabled"})}),(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.enabledDescription,defaultText:"To disable push notifications from {{hostname}} access your browser permissions for this site and turn off notifications. <a href='https://owncast.online/docs/notifications'>Learn more.</a>",vars:{hostname:window.location.hostname.toString()}})]}),C=()=>(0,r.jsxs)("div",{children:[(0,r.jsx)(W,{level:2,children:(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.deniedTitle,defaultText:"Notifications are blocked on your device"})}),(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.deniedDescription,defaultText:"To enable push notifications from {{hostname}} access your browser permissions for this site and turn on notifications. Then reload this page to apply your updated settings on this site. <a href='https://owncast.online/docs/notifications'>Learn more.</a>",vars:{hostname:window.location.hostname.toString()}})]}),k=()=>{let{t:e}=(0,p.$G)(),[t,o]=(0,d.useState)(null),n=(0,u.sJ)(w.FI),i=(0,u.sJ)(w.g1),[c,f]=(0,d.useState)(!1),j=(0,M.w)()&&"granted"===Notification.permission,W=(0,M.w)()&&"denied"===Notification.permission,{notifications:k}=i,{browser:K}=k,{publicKey:S}=K,P=K.enabled&&((0,M.w)()||(0,g.rZ)());if(j)return(0,r.jsx)(F,{});if(W)return(0,r.jsx)(C,{});if((0,g.C9)()&&!(0,g.rZ)())return(0,r.jsx)(T,{});let A=async()=>{if(!(0,M.w)()||"default"===Notification.permission){f(!0);try{let e=await x(S);y("BROWSER_PUSH_NOTIFICATION",e,n),o(null)}catch(t){o(e(b.W.Frontend.BrowserNotifyModal.errorMessage,{message:t.message}))}f(!1)}};return"localhost"===window.location.hostname?(0,r.jsx)(B,{}):P?(0,r.jsx)(h.SV,{fallbackRender:e=>{let{error:t,resetErrorBoundary:o}=e;return(0,r.jsx)(m.A,{componentName:"BrowserNotifyModal",message:t.message,retryFunction:o})},children:(0,r.jsxs)(s.Z,{spinning:c,children:[(0,r.jsxs)(a.Z,{className:v().description,children:[(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.mainDescription,defaultText:"Get notified right in the browser each time this stream goes live."}),(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.learnMoreAboutNotifications,defaultText:"<a href='https://owncast.online/docs/notifications/#browser-notifications'>Learn more</a> about Owncast browser notifications."})]}),(0,r.jsx)(a.Z,{children:t&&(0,r.jsx)(l.Z,{message:(0,r.jsx)(N.W,{translationKey:b.W.Frontend.BrowserNotifyModal.errorTitle,defaultText:"Browser Notification Error"}),description:t,type:"error",closable:!0,className:v().errorAlert,onClose:()=>o(null)})}),(0,r.jsx)(O,{start:()=>A()})]})}):(0,r.jsx)(_,{})}},72285:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M328 544h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8z"}},{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 728H184V184h656v656z"}}]},name:"plus-square",theme:"outlined"}},81640:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"}},99677:function(e,t,o){"use strict";var r=o(64836),n=o(18698);t.Z=void 0;var i=r(o(42122)),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=n(e)&&"function"!=typeof e)return{default:e};var o=d(void 0);if(o&&o.has(e))return o.get(e);var r={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&({}).hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=e[s]}return r.default=e,o&&o.set(e,r),r}(o(67294)),a=r(o(72285)),l=r(o(3247));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(d=function(e){return e?o:t})(e)}var c=s.forwardRef(function(e,t){return s.createElement(l.default,(0,i.default)((0,i.default)({},e),{},{ref:t,icon:a.default}))});t.Z=c},61337:function(e,t,o){"use strict";var r=o(64836),n=o(18698);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=r(o(42122)),s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=n(e)&&"function"!=typeof e)return{default:e};var o=d(void 0);if(o&&o.has(e))return o.get(e);var r={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if("default"!==s&&({}).hasOwnProperty.call(e,s)){var a=i?Object.getOwnPropertyDescriptor(e,s):null;a&&(a.get||a.set)?Object.defineProperty(r,s,a):r[s]=e[s]}return r.default=e,o&&o.set(e,r),r}(o(67294)),a=r(o(81640)),l=r(o(3247));function d(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,o=new WeakMap;return(d=function(e){return e?o:t})(e)}var c=s.forwardRef(function(e,t){return s.createElement(l.default,(0,i.default)((0,i.default)({},e),{},{ref:t,icon:a.default}))});t.default=c},38355:function(e){e.exports={description:"BrowserNotifyModal_description__G5jk5",errorAlert:"BrowserNotifyModal_errorAlert__5Sc89",pushPreview:"BrowserNotifyModal_pushPreview__RuEzl",inner:"BrowserNotifyModal_inner__iC07B",title:"BrowserNotifyModal_title__L6D4G",permissionLine:"BrowserNotifyModal_permissionLine__C7NWu",bell:"BrowserNotifyModal_bell__7LVGs",buttonRow:"BrowserNotifyModal_buttonRow__XcR9z",disabled:"BrowserNotifyModal_disabled__yqYtE"}}}]);